import csv
import pymongo

# Conéctate a tu clúster de MongoDB
client = pymongo.MongoClient("mongodb+srv://POE:Manu7190@cluster0.avhhgxe.mongodb.net/?retryWrites=true&w=majority")

# Selecciona la base de datos que deseas utilizar
db = client["Medicamentos"]

# Selecciona la colección en la que has guardado los datos
collection = db["Datos"]

# Obtén todos los documentos de la colección
data = collection.find()

# Nombre del archivo CSV de salida
csv_file = "datos_medicamentos.csv"

# Encabezados del archivo CSV
fields = ["Establecimiento", "Nombre", "Precio", "timestamp"]

# Abre el archivo CSV en modo escritura
with open(csv_file, 'w', newline='', encoding='utf-8') as csvfile:
    # Crea un escritor CSV
    csvwriter = csv.DictWriter(csvfile, fieldnames=fields)
    
    # Escribe los encabezados en el archivo CSV
    csvwriter.writeheader()
    
    # Itera sobre los documentos en la colección
    for doc in data:
        # Elimina el campo '_id' del documento
        doc.pop('_id', None)
        # Escribe cada documento como una fila en el archivo CSV
        csvwriter.writerow(doc)

